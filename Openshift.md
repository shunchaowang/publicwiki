# add custom route to openshift with helm chart
- use chart additions
This is to add additional kubernetes objects to a specific helm chart and release, we can add microservice, route and
cron to the release.
Here are the steps to add chart additons:
1. create the templates under the `chart/` folder in the repository
We can have any type of folder structure under the `chart/` foler, then we provide the path under `chart/` to the file
as part of the values configuration.
2. Add the template file(s) to the values files under the approciate chart.
**Example** I want to add an additional route to the route chart, first I provide the route template in the `chart/`
folder.
Here is the app repo:
```
.gitlab-ci.yml
Dockerfile
.deploy/
    values.yaml
...
chart/
    customRoute.yaml
```
`chart/customRoute.yaml` is the helm template of and additional route to deploy.
Next I configure the values file(s) to use the custom route template.
```
# values.yaml
charts:
    route: # this ca nbe microservice, route, or cron
        files:
            - "customRoute.yaml"
```
This will add the custom route to the route helm chart and deploy as part of the route helm release.

- use chart overrides
To override the helm charts, I utilize a tool [Kustomize](https://kustomize.io/), Kustomize inserts new configurations
to the kubernetes manifests generated by the helm after templating. To set up overrides there are two steps:
1. Create the kustomize templates under the `chart/kustomize/$CHART_NAME/templates` folder in the repository.
> $CHART_NAME refers to the helm chart that is deployed. I need to know which chart to override:
- `microservice`
- `route`
- `cron`
2. Create the `kustomization.yaml` file for the chart under `chart/kustomize/$CHART_NAME/kustomization.yaml`.
> This file tells Kustomize how to apply the overrides, kustomize will look for all resources that match the
configuration and apply the overrides to them.
**Example**
We have a repo to add an additional port to the container:
```
# repo's file structure
.gitlab-ci.yml
Dockerfile
.deploy/
    values.yaml
...
chart/
    kustomize/
        microservice/
            kustomization.yaml
            templates/
                deployment.yaml
```
`chart/kustomize/microservice/templates/deployment.yaml` is the kustomize patch file to apply to the microservice
chart's deployment kubernetes resources.
```
# chart/kustomize/microservice/templates/deployment.yaml

kind: Deployment
metadata:
    name: does-not-matter
spec:
    tempalte:
        spec:
            containers:
                - name: {{ include "blabla" . }}
                  ports:
                    - containerPort: 9090
                      protocol: TCP
```
Kustomize determines which resources to apply this override to using the `kustomization.yaml` file. Next I set up the
`chart/kustomize/microservice/kustomization.yaml` file that tells kustomize which resource to apply this to.
```
# chart/kustomize/microservice/kustomization.yaml

resources:
    - all.yaml
patches:
    - path: deployment.yaml
      target:
        kind: Deployment
```

            
